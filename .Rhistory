# lines(WLs,data.minus1d[,ispecies,ileaf], col = "red",lwd = 2)
}
}
}
cN <- param_all[,"Nmean"] +
param_all[,paste0("nu_site_N[",isite,"]")] +
param_all[,paste0("nu_species_N[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_N[",isite,", ",ispecies,", ",ileaf,"]")]
cCab <- param_all[,"Cabmean"] +
param_all[,paste0("nu_site_Cab[",isite,"]")] +
param_all[,paste0("nu_species_Cab[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cab[",isite,", ",ispecies,", ",ileaf,"]")]
cCar <- param_all[,"Carmean"] +
param_all[,paste0("nu_isite_Car[",isite,"]")] +
param_all[,paste0("nu_species_Car[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Car[",isite,", ",ispecies,", ",ileaf,"]")]
cCw <- param_all[,"Cwmean"] +
param_all[,paste0("nu_site_Cw[",isite,"]")] +
param_all[,paste0("nu_species_Cw[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cw[",isite,", ",ispecies,", ",ileaf,"]")]
param_all[,"Carmean"]
param_all[,"Carmean"] +
param_all[,paste0("nu_isite_Car[",isite,"]")]
cCar <- param_all[,"Carmean"] +
param_all[,paste0("nu_site_Car[",isite,"]")] +
param_all[,paste0("nu_species_Car[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Car[",isite,", ",ispecies,", ",ileaf,"]")]
cCw <- param_all[,"Cwmean"] +
param_all[,paste0("nu_site_Cw[",isite,"]")] +
param_all[,paste0("nu_species_Cw[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cw[",isite,", ",ispecies,", ",ileaf,"]")]
cCm <- param_all[,"Cmmean"] +
param_all[,paste0("nu_site_Cm[",isite,"]")] +
param_all[,paste0("nu_species_Cm[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cm[",isite,", ",ispecies,", ",ileaf,"]")]
all_N[isite,ispecies,ileaf,] <- cN
all_Cab[isite,ispecies,ileaf,] <- cCab
all_Car[isite,ispecies,ileaf,] <- cCar
all_Cw[isite,ispecies,ileaf,] <- cCw
all_Cm[isite,ispecies,ileaf,] <- cCm
tmp <- matrix(unlist(lapply(1:Nsimu,function(isimu){
rrtm::prospect5(N = cN[isimu],
Cab = cCab[isimu],
Car = cCar[isimu],
Cbrown = 0,
Cw = cCw[isimu],
Cm = cCm[isimu])[["reflectance"]][pos]})),ncol = Nsimu)
array_mod_reflectance[,isite,ispecies,ileaf,] <- tmp
array_mod_reflectance <- array(data = NA,c(dim(data.minus1d),Nsimu))
all_N <- all_Cab <- all_Car <- all_Cw <- all_Cm <-
array(data = NA, c(max(Nsites),max(Nspecies),max(Nleaves),Nsimu))
for (isite in seq(1,Nsites)){
for (ispecies in seq(1,Nspecies[isite])){
print(c(isite,ispecies))
for (ileaf in seq(1,Nleaves[isite,ispecies])){
cN <- param_all[,"Nmean"] +
param_all[,paste0("nu_site_N[",isite,"]")] +
param_all[,paste0("nu_species_N[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_N[",isite,", ",ispecies,", ",ileaf,"]")]
cCab <- param_all[,"Cabmean"] +
param_all[,paste0("nu_site_Cab[",isite,"]")] +
param_all[,paste0("nu_species_Cab[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cab[",isite,", ",ispecies,", ",ileaf,"]")]
cCar <- param_all[,"Carmean"] +
param_all[,paste0("nu_site_Car[",isite,"]")] +
param_all[,paste0("nu_species_Car[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Car[",isite,", ",ispecies,", ",ileaf,"]")]
cCw <- param_all[,"Cwmean"] +
param_all[,paste0("nu_site_Cw[",isite,"]")] +
param_all[,paste0("nu_species_Cw[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cw[",isite,", ",ispecies,", ",ileaf,"]")]
cCm <- param_all[,"Cmmean"] +
param_all[,paste0("nu_site_Cm[",isite,"]")] +
param_all[,paste0("nu_species_Cm[",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cm[",isite,", ",ispecies,", ",ileaf,"]")]
all_N[isite,ispecies,ileaf,] <- cN
all_Cab[isite,ispecies,ileaf,] <- cCab
all_Car[isite,ispecies,ileaf,] <- cCar
all_Cw[isite,ispecies,ileaf,] <- cCw
all_Cm[isite,ispecies,ileaf,] <- cCm
tmp <- matrix(unlist(lapply(1:Nsimu,function(isimu){
rrtm::prospect5(N = cN[isimu],
Cab = cCab[isimu],
Car = cCar[isimu],
Cbrown = 0,
Cw = cCw[isimu],
Cm = cCm[isimu])[["reflectance"]][pos]})),ncol = Nsimu)
array_mod_reflectance[,isite,ispecies,ileaf,] <- tmp
# matplot(WLs,array_mod_reflectance[,ispecies,ileaf,],type = 'l')
# lines(WLs,data.minus1d[,ispecies,ileaf], col = "red",lwd = 2)
}
}
}
all_parameters <- bind_rows(list(melt(all_N) %>% mutate(param = "N"),
melt(all_Cab) %>% mutate(param = "Cab"),
melt(all_Car) %>% mutate(param = "Car"),
melt(all_Cw) %>% mutate(param = "Cw"),
melt(all_Cm) %>% mutate(param = "Cm"))) %>% filter(!is.na(value)) %>% rename(site = Var1,
species = Var2,
leaf = Var3,
simu = Var4)
X <- as.vector(apply(array_mod_reflectance,c(1,2,3),mean,na.rm = TRUE))
Y <- as.vector(data.minus1d)
plot(X,Y)
length(X)
length(Y)
X <- as.vector(apply(array_mod_reflectance,c(1,2,3,4),mean,na.rm = TRUE))
Y <- as.vector(data.minus1d)
plot(X,Y)
abline(a = 0, b = 1, col ='red')
LM <- lm(data.frame(x = X,y = Y),formula = y ~ x)
summary(LM)
sqrt(c(crossprod(LM$residuals))/length(LM$residuals))
par(mfrow = c(1,2))
matplot(WLs,data.2d.NA,type = 'l')
matplot(WLs,matrix(apply(array_mod_reflectance,c(1,2,3),mean),nrow = Nwl),type = 'l')
mcmc.out$WAIC
ggplot(data = all_parameters) +
geom_density_ridges(aes(x = value, y = as.factor(site), fill = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
ggplot(data = all_parameters) +
geom_density_ridges(aes(x = value, y = as.factor(site), group = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
ggplot(data = all_parameters) +
geom_density_ridges(aes(x = value, y = as.factor(site), fill = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
source('~/.active-rstudio-document', echo=TRUE)
c(Nwl,NGF,max(Nsites),max(Nspecies),max(Nleaves)
source('~/.active-rstudio-document', echo=TRUE)
data.mean <- data.raw[,1:2,1:2,1:2,1:2,1:3]
dims <- dim(data.mean)
data.minus1d <- array(data = data.mean, dim = c(dims[1:(length(dims)-2)],dims[length(dims)-1]*dims[length(dims)]))
data.2d.NA <- matrix(data.mean,nrow = Nwl)
par(mfrow = c(1,1))
matplot(WLs,data.2d.NA,type = 'l')
source('~/.active-rstudio-document', echo=TRUE)
plot(param[,c("Nmean","Cabmean","Cwmean","Cmmean")])
hist(as.vector(as.matrix(param[,which(grepl("nu_site_N",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_species_N",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_leaf_Cab",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_GF_N",colnames(param$chain1)))])))
plot(param[,c("Nmean","Cabmean","Cwmean","Cmmean")])
plot(param[,c("Nmean","Cabmean","Carmean","Cwmean","Cmmean")])
all_N <- all_Cab <- all_Car <- all_Cw <- all_Cm <-
array(data = NA, c(NGF,max(Nsites),max(Nspecies),max(Nleaves),Nsimu))
array_mod_reflectance <- array(data = NA,c(dim(data.minus1d),Nsimu))
all_N <- all_Cab <- all_Car <- all_Cw <- all_Cm <-
array(data = NA, c(NGF,max(Nsites),max(Nspecies),max(Nleaves),Nsimu))
for (iGF in seq(1,NGF)){
for (isite in seq(1,Nsites[iGF])){
for (ispecies in seq(1,Nspecies[iGF,isite])){
print(c(iGF,isite,ispecies))
for (ileaf in seq(1,Nleaves[iGF,isite,ispecies])){
cN <- param_all[,"Nmean"] +
param_all[,paste0("nu_GF_N[",iGF,"]")] +
param_all[,paste0("nu_site_N[",iGF,", ",isite,"]")] +
param_all[,paste0("nu_species_N[",iGF,", ",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_N[",iGF,", ",isite,", ",ispecies,", ",ileaf,"]")]
cCab <- param_all[,"Cabmean"] +
param_all[,paste0("nu_GF_Cab[",iGF,"]")] +
param_all[,paste0("nu_site_Cab[",iGF,", ",isite,"]")] +
param_all[,paste0("nu_species_Cab[",iGF,", ",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cab[",iGF,", ",isite,", ",ispecies,", ",ileaf,"]")]
cCar <- param_all[,"Carmean"] +
param_all[,paste0("nu_GF_Car[",iGF,"]")] +
param_all[,paste0("nu_site_Car[",iGF,", ",isite,"]")] +
param_all[,paste0("nu_species_Car[",iGF,", ",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Car[",iGF,", ",isite,", ",ispecies,", ",ileaf,"]")]
cCw <- param_all[,"Cwmean"] +
param_all[,paste0("nu_GF_Cw[",iGF,"]")] +
param_all[,paste0("nu_site_Cw[",iGF,", ",isite,"]")] +
param_all[,paste0("nu_species_Cw[",iGF,", ",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cw[",iGF,", ",isite,", ",ispecies,", ",ileaf,"]")]
cCm <- param_all[,"Cmmean"] +
param_all[,paste0("nu_GF_Cm[",iGF,"]")] +
param_all[,paste0("nu_site_Cm[",iGF,", ",isite,"]")] +
param_all[,paste0("nu_species_Cm[",iGF,", ",isite,", ",ispecies,"]")] +
param_all[,paste0("nu_leaf_Cm[",iGF,", ",isite,", ",ispecies,", ",ileaf,"]")]
all_N[iGF,isite,ispecies,ileaf,] <- cN
all_Cab[iGF,isite,ispecies,ileaf,] <- cCab
all_Car[iGF,isite,ispecies,ileaf,] <- cCar
all_Cw[iGF,isite,ispecies,ileaf,] <- cCw
all_Cm[iGF,isite,ispecies,ileaf,] <- cCm
tmp <- matrix(unlist(lapply(1:Nsimu,function(isimu){
rrtm::prospect5(N = cN[isimu],
Cab = cCab[isimu],
Car = cCar[isimu],
Cbrown = 0,
Cw = cCw[isimu],
Cm = cCm[isimu])[["reflectance"]][pos]})),ncol = Nsimu)
array_mod_reflectance[,iGF,isite,ispecies,ileaf,] <- tmp
# matplot(WLs,array_mod_reflectance[,ispecies,ileaf,],type = 'l')
# lines(WLs,data.minus1d[,ispecies,ileaf], col = "red",lwd = 2)
}
}
}
}
all_parameters <- bind_rows(list(melt(all_N) %>% mutate(param = "N"),
melt(all_Cab) %>% mutate(param = "Cab"),
melt(all_Car) %>% mutate(param = "Car"),
melt(all_Cw) %>% mutate(param = "Cw"),
melt(all_Cm) %>% mutate(param = "Cm"))) %>% filter(!is.na(value)) %>% rename(GF = Var1,
site = Var2,
species = Var3,
leaf = Var4,
simu = Var5)
ggplot(data = all_parameters) +
geom_density_ridges(aes(x = value, y = as.factor(GF), fill = as.factor(species)), alpha = 0.4) +
facet_wrap(as.factor(site) ~ param, scales = "free") +
theme_bw()
ggplot(data = all_parameters) +
geom_density_ridges(aes(x = value, y = as.factor(GF), fill = as.factor(species)), alpha = 0.4) +
facet_grid(as.factor(site) ~ param, scales = "free") +
theme_bw()
X <- as.vector(apply(array_mod_reflectance,c(1,2,3,4,5),mean,na.rm = TRUE))
Y <- as.vector(data.minus1d)
plot(X,Y)
mcmc.out$WAIC
hist(cN)
par(mfrow=c(1,1))
hist(cN)
hist(cCab)
source('~/.active-rstudio-document', echo=TRUE)
hist(as.vector(as.matrix(param[,which(grepl("nu_site_N",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_site_N.1..1",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_site_N.1..2",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_site_N.2..1",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_site_N.2..2",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_GF_N",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_GF_N.1",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_GF_N.2",colnames(param$chain1)))])))
plot(param[,c("Nmean","Cabmean","Carmean","Cwmean","Cmmean")])
64*3
LianaHPDA::Nspecies
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
#                                     "nu_leaf_N","nu_leaf_Cab","nu_leaf_Car","nu_leaf_Cw","nu_leaf_Cm"),
#                        data = Data,
#                        inits = Inits,
#                        nburnin = 2000,
#                        nchains = Nchains,
#                        niter = 4000,
#                        thin = 10,
#                        summary = TRUE,
#                        WAIC = TRUE,
#                        samplesAsCodaMCMC = TRUE)
system2("rsync",paste("-avz","hpc:/data/gent/vo/000/gvo00074/felicien/R/LianaHPDA/outputs/MCMC.multispecies.RDS","./outputs/"))
mcmc.out <- readRDS("./outputs/MCMC.multispecies.RDS")
MCMCsamples <- mcmc.out$samples
param <- MCMCsamples[,]
Nsimu <- min(1000,nrow(MCMCsamples[[1]]))
pos.simu <- sample(1:nrow(MCMCsamples[[1]]),Nsimu)
param_all <- do.call(rbind,lapply(1:Nchains,function(i) MCMCsamples[[i]][pos.simu,]))[sample(1:(Nchains*Nsimu),Nsimu),]
plot(param[,c("Nmean","Cabmean","Cwmean","Cmmean")])
plot(param[,"nu_species_Cab[2]"])
hist(as.vector(as.matrix(param[,which(grepl("nu_species_N",colnames(param$chain1)))])))
hist(as.vector(as.matrix(param[,which(grepl("nu_leaf_Cab",colnames(param$chain1)))])))
array_mod_reflectance <- array(data = NA,c(dim(data.minus1d),Nsimu))
all_N <- all_Cab <- all_Car <- all_Cw <- all_Cm <-
array(data = NA, c(Nspecies,max(Nleaves),Nsimu))
for (ispecies in seq(1,Nspecies)){
print(ispecies)
for (ileaf in seq(1,Nleaves[ispecies])){
cN <- param_all[,"Nmean"] + param_all[,paste0("nu_species_N[",ispecies,"]")] + param_all[,paste0("nu_leaf_N[",ispecies,", ",ileaf,"]")]
cCab <- param_all[,"Cabmean"] + param_all[,paste0("nu_species_Cab[",ispecies,"]")] + param_all[,paste0("nu_leaf_Cab[",ispecies,", ",ileaf,"]")]
cCar <- param_all[,"Carmean"] + param_all[,paste0("nu_species_Car[",ispecies,"]")] + param_all[,paste0("nu_leaf_Car[",ispecies,", ",ileaf,"]")]
cCw <- param_all[,"Cwmean"] + param_all[,paste0("nu_species_Cw[",ispecies,"]")] + param_all[,paste0("nu_leaf_Cw[",ispecies,", ",ileaf,"]")]
cCm <- param_all[,"Cmmean"] + param_all[,paste0("nu_species_Cm[",ispecies,"]")] + param_all[,paste0("nu_leaf_Cm[",ispecies,", ",ileaf,"]")]
all_N[ispecies,ileaf,] <- cN
all_Cab[ispecies,ileaf,] <- cCab
all_Car[ispecies,ileaf,] <- cCar
all_Cw[ispecies,ileaf,] <- cCw
all_Cm[ispecies,ileaf,] <- cCm
tmp <- matrix(unlist(lapply(1:Nsimu,function(isimu){
rrtm::prospect5(N = cN[isimu],
Cab = cCab[isimu],
Car = cCar[isimu],
Cbrown = 0,
Cw = cCw[isimu],
Cm = cCm[isimu])[["reflectance"]][pos]})),ncol = Nsimu)
array_mod_reflectance[,ispecies,ileaf,] <- tmp
# matplot(WLs,array_mod_reflectance[,ispecies,ileaf,],type = 'l')
# lines(WLs,data.minus1d[,ispecies,ileaf], col = "red",lwd = 2)
}
}
ispecies
ileaf
cN <- param_all[,"Nmean"] + param_all[,paste0("nu_species_N[",ispecies,"]")] + param_all[,paste0("nu_leaf_N[",ispecies,", ",ileaf,"]")]
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
?conf.int
conf.int
confint
?stat_ellipse
library(ellipse)
ellipse
?ellipse
0.4/4.6
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
mcmc.out$WAIC
# system2("rsync",paste("-avz","hpc:/data/gent/vo/000/gvo00074/felicien/R/LianaHPDA/outputs/MCMC.multispecies.RDS","./outputs/"))
mcmc.out <- readRDS("./outputs/MCMC.multispecies.RDS")
mcmc.out$WAIC
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
mcmc.out$WAIC
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
mcmc.out$WAIC
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
data.spectra <- readRDS("./data/All.spectra.RDS"
)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id = 1, ind.id == 1)
library(dplyr)
library(purrr)
library(tidyr)
library(ggplot2)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id = 1, ind.id == 1)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 1)
data.spectra <- readRDS("./data/All.spectra.RDS") %>%
group_by(GF,site,Species) %>% mutate(species.id = cur_group_id()) %>% group_by(GF,site) %>% mutate(species.id = species.id - min(species.id) + 1) %>%
group_by(GF,site,species.id,Ind) %>% mutate(ind.id = cur_group_id()) %>% group_by(GF,site,species.id) %>% mutate(ind.id = ind.id - min(ind.id) + 1) %>%
group_by(GF,site,species.id,ind.id,name) %>% mutate(leaf.id = cur_group_id()) %>% group_by(GF,site,species.id,ind.id) %>% mutate(leaf.id = leaf.id - min(leaf.id) + 1) %>%
mutate(Identification = paste(GF,site,species.id,ind.id,leaf.id,sep = "_")) %>%
mutate(value.corrected = value)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 1)
ggplot(data = example)+
geom_line(aes(x = wv,y = value, group = leaf.id))
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 2)
ggplot(data = example)+
geom_line(aes(x = wv,y = value, group = leaf.id))
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 3)
ggplot(data = example)+
geom_line(aes(x = wv,y = value, group = leaf.id))
data.spectra <- readRDS("./data/All.spectra_corrected.RDS") %>%
group_by(GF,site,Species) %>% mutate(species.id = cur_group_id()) %>% group_by(GF,site) %>% mutate(species.id = species.id - min(species.id) + 1) %>%
group_by(GF,site,species.id,Ind) %>% mutate(ind.id = cur_group_id()) %>% group_by(GF,site,species.id) %>% mutate(ind.id = ind.id - min(ind.id) + 1) %>%
group_by(GF,site,species.id,ind.id,name) %>% mutate(leaf.id = cur_group_id()) %>% group_by(GF,site,species.id,ind.id) %>% mutate(leaf.id = leaf.id - min(leaf.id) + 1) %>%
mutate(Identification = paste(GF,site,species.id,ind.id,leaf.id,sep = "_")) %>%
mutate(value.corrected = value)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 3)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 2, ind.id == 1)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))
saveRDS(example,file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
head(example)
ggplot(data = example)+
geom_line(aes(x = wv,y = value, group = leaf.id))
saveRDS(example %>% dplyr::select(wv,value,leaf.id),file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
saveRDS(example %>% ungroup() %>% dplyr::select(wv,value,leaf.id),file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
ggplot(data = example)+
geom_line(aes(x = wv,y = value, group = leaf.id))+
theme_bw()
data.spectra <- readRDS("./data/All.spectra_corrected.RDS") %>%
group_by(GF,site,Species) %>% mutate(species.id = cur_group_id()) %>% group_by(GF,site) %>% mutate(species.id = species.id - min(species.id) + 1) %>%
group_by(GF,site,species.id,Ind) %>% mutate(ind.id = cur_group_id()) %>% group_by(GF,site,species.id) %>% mutate(ind.id = ind.id - min(ind.id) + 1) %>%
group_by(GF,site,species.id,ind.id,name) %>% mutate(leaf.id = cur_group_id()) %>% group_by(GF,site,species.id,ind.id) %>% mutate(leaf.id = leaf.id - min(leaf.id) + 1) %>%
mutate(Identification = paste(GF,site,species.id,ind.id,leaf.id,sep = "_")) %>%
mutate(value.corrected = value)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 1)
ggplot(data = example)+
geom_line(aes(x = wv,y = value, group = leaf.id))+
theme_bw()
saveRDS(example %>% ungroup() %>% dplyr::select(wv,value,leaf.id),
file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
data.spectra <- readRDS("./data/All.spectra_corrected.RDS") %>%
group_by(GF,site,Species) %>% mutate(species.id = cur_group_id()) %>% group_by(GF,site) %>% mutate(species.id = species.id - min(species.id) + 1) %>%
group_by(GF,site,species.id,Ind) %>% mutate(ind.id = cur_group_id()) %>% group_by(GF,site,species.id) %>% mutate(ind.id = ind.id - min(ind.id) + 1) %>%
group_by(GF,site,species.id,ind.id,name) %>% mutate(leaf.id = cur_group_id()) %>% group_by(GF,site,species.id,ind.id) %>% mutate(leaf.id = leaf.id - min(leaf.id) + 1) %>%
mutate(Identification = paste(GF,site,species.id,ind.id,leaf.id,sep = "_")) %>%
mutate(value.corrected = value)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 2, ind.id == 1)
ggplot(data = example)+
geom_line(aes(x = wv,y = value, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 1)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 2)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
saveRDS(example %>% ungroup() %>% dplyr::select(wv,value,leaf.id),
file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 3)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 4)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 4)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
saveRDS(example %>% ungroup() %>% dplyr::select(wv,value,leaf.id),
file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 2, ind.id == 1)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
saveRDS(example %>% ungroup() %>% dplyr::select(wv,value,leaf.id),
file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
ggplot(data = all_parameters) +
geom_density(aes(x = value, fill = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
plot(param[,c("Nmean","Cabmean","Carmean","Cwmean","Cmmean")])
all_parameters <- bind_rows(list(melt(all_N) %>% mutate(param = "N"),
melt(all_Cab) %>% mutate(param = "Cab"),
melt(all_Car) %>% mutate(param = "Car"),
melt(all_Cw) %>% mutate(param = "Cw"),
melt(all_Cm) %>% mutate(param = "Cm"))) %>% filter(!is.na(value)) %>% rename(species = Var1,
leaf = Var2,
simu = Var3)
ggplot(data = all_parameters) +
geom_density(aes(x = value, fill = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
data.spectra <- readRDS("./data/All.spectra_corrected.RDS") %>%
group_by(GF,site,Species) %>% mutate(species.id = cur_group_id()) %>% group_by(GF,site) %>% mutate(species.id = species.id - min(species.id) + 1) %>%
group_by(GF,site,species.id,Ind) %>% mutate(ind.id = cur_group_id()) %>% group_by(GF,site,species.id) %>% mutate(ind.id = ind.id - min(ind.id) + 1) %>%
group_by(GF,site,species.id,ind.id,name) %>% mutate(leaf.id = cur_group_id()) %>% group_by(GF,site,species.id,ind.id) %>% mutate(leaf.id = leaf.id - min(leaf.id) + 1) %>%
mutate(Identification = paste(GF,site,species.id,ind.id,leaf.id,sep = "_")) %>%
mutate(value.corrected = value)
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 1)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 2)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 3)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 4, ind.id == 4)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 4)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 2)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 3)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 4)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
example <- data.spectra %>% filter(GF == "Tree", site == "PNM",species.id == 1, ind.id == 5)
ggplot(data = example)+
geom_line(aes(x = wv,y = value.corrected, group = leaf.id))+
theme_bw()
saveRDS(example %>% ungroup() %>% dplyr::select(wv,value,leaf.id),
file = "/home/femeunier/Documents/projects/NIMBLE.PROSPECT/data/example.spectrum.RDS")
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
plot(param[,c("Nmean","Cabmean","Carmean","Cwmean","Cmmean")])
plot(param[,"nu_species_N[4]"])
plot(param[,"nu_leaf_N[2, 2]"])
data.mean <- data.raw[,2,1,3:6,1:4,1:3]
dims <- dim(data.mean)
data.minus1d <- array(data = data.mean, dim = c(dims[1:(length(dims)-2)],dims[length(dims)-1]*dims[length(dims)]))
data.2d.NA <- matrix(data.mean,nrow = Nwl)
par(mfrow = c(1,1))
matplot(WLs,data.2d.NA,type = 'l')
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
mcmc.out$WAIC
ggplot(data = all_parameters) +
geom_density(aes(x = value, fill = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
ggplot(data = Mean_effects) +
geom_density(aes(x = value, fill = as.factor(param)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
ggplot(data = all_species_effects) +
geom_density(aes(x = value, fill = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
ggplot(data = all_leaves_effects) +
geom_density(aes(x = value, fill = as.factor(leaf)), alpha = 0.4) +
facet_wrap(param ~ species, scales = "free",ncol = 4) +
geom_vline(xintercept = 0) +
theme_bw()
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
ggplot(data = all_parameters) +
geom_density(aes(x = value, fill = as.factor(species)), alpha = 0.4) +
facet_wrap(~ param, scales = "free") +
theme_bw()
plot(param[,c("Nmean","Cabmean","Carmean","Cwmean","Cmmean")])
plot(param[,"nu_species_N[4]"])
plot(param[,"nu_leaf_N[2, 2]"])
mcmc.out$WAIC
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.multiple.species.R', echo=TRUE)
plot(param[,c("Nmean","Cabmean","Carmean","Cwmean","Cmmean")])
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.species.R', echo=TRUE)
source('/home/femeunier/Documents/projects/LianaHPDA/scripts/HPDA.species.R', echo=TRUE)
